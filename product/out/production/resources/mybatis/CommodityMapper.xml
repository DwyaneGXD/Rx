<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.oasis.rx.product.dao.CommodityDao">

    <resultMap type="com.oasis.rx.product.entity.vo.ProductCommodityModel" id="List_result">
        <id column="id" property="id"/>
        <result column="goods_id" property="goodsId"/>
        <result column="standard" property="standard"/>
        <result column="produce_factory" property="produceFactory"/>
        <result column="pid" property="productId"/>
        <result column="source" property="source"/>
        <result column="price" property="price"/>
        <result column="commodity_name" property="name"/>
    </resultMap>

    <!-- 模块调用-根据产品id查所有商品 -->
    <select id="findCommodityId" parameterType="java.lang.String" resultMap="List_result">
        SELECT c.id, c.goods_id, c.source, c.price, c.commodity_name, p.id as pid, p.standard, p.produce_factory
        FROM
        t_commodity AS c
        LEFT JOIN t_product AS p ON p.id=c.product_id
        WHERE
        product_id =#{arg0} and c.is_delete =0 and p.produce_factory != ''
    </select>

    <!-- 后台-删除商品 -->
    <delete id="deleteCommodity" parameterType="java.lang.String">
        UPDATE t_commodity co
        SET co.is_delete=1
        WHERE co.id=#{id} AND co.is_delete=0
    </delete>

    <!-- 后台-根据名称分页查询商品信息 -->
    <select id="findCommoditiesLike" parameterType="java.lang.String"
            resultType="com.oasis.rx.product.entity.CommodityEntity">
        <bind name="_nameLike" value="'%'+nameLike+'%'"/>
        SELECT
        co.id,
        co.goods_id AS goodsId,
        co.commodity_name AS commodityName,
        co.source,
        co.price,
        co.product_id AS productId
        FROM
        t_commodity co
        WHERE
        <if test="nameLike != null">
            co.commodity_name like #{_nameLike}
        </if>
        AND co.source = #{sourceTrim}
        AND co.is_delete=0
    </select>

    <!-- 后台-根据名称查询商品信息,token权限泓华,查全部 -->
    <select id="findCommodityLikeAll" parameterType="java.lang.String"
            resultType="com.oasis.rx.product.entity.CommodityEntity">
        <bind name="_nameLike" value="'%'+nameLike+'%'"/>
        SELECT
        co.id,
        co.goods_id AS goodsId,
        co.commodity_name AS commodityName,
        co.source,
        co.price,
        co.product_id AS productId
        FROM
        t_commodity co
        <where>
            <if test="nameLike != null and nameLike !=&quot;&quot;">
                co.commodity_name like #{_nameLike}
            </if>
            AND co.is_delete=0
        </where>
    </select>

    <!-- 后台-根据名称查询商品信息,token权限不为泓华,查各自的 -->
    <select id="findCommodityLike" parameterType="java.lang.String"
            resultType="com.oasis.rx.product.entity.CommodityEntity">
        <bind name="_nameLike" value="'%'+nameLike+'%'"/>
        <bind name="_source" value="source"/>
        SELECT
        co.id,
        co.goods_id AS goodsId,
        co.commodity_name AS commodityName,
        co.source,
        co.price,
        co.product_id AS productId
        FROM
        t_commodity co
        <where>
            <if test="nameLike != null and nameLike !=&quot;&quot;">
                co.commodity_name like #{_nameLike}
            </if>
            AND co.source = #{_source}
            AND co.is_delete=0
        </where>
    </select>

    <!-- 后台-判断一个产品在相同来源下是否有商品 -->
    <select id="findCommodityByIdAndSource" resultType="com.oasis.rx.product.entity.CommodityEntity">
        <bind name="_id" value="id"/>
        <bind name="_source" value="source"/>
        SELECT
        co.id,
        co.goods_id AS goodsId,
        co.commodity_name AS commodityName,
        co.source,
        co.price,
        co.product_id AS productId
        FROM
        t_commodity co
        WHERE
        co.product_id=#{_id} AND co.source=#{_source} AND co.is_delete=0
    </select>
</mapper>